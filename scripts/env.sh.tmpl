#!/bin/bash

# ubuntu 16.04 eu-west-1
AMI_ID="ami-8ac04ff9"
COUNT_WORKERS=3
INSTANCE_PROFILE=
INSTANCE_TYPE_WORKERS="m4.large"
INSTANCE_TYPE_SERVERS="m4.large"
SSH_KEYNAME=

# only optional to get the needed VPC_ID, SECURITY_GROUP_ID, SUBNET_ID and ELB_SUBNET_IDS
VPC_NAME=
SUBNET_NAME=
ELB_SUBNET_NAMES=

# these are resolved dynamically with awscli but can also set statically
VPC_ID=$(aws ec2 describe-vpcs --filters "Name=tag:Name,Values=$VPC_NAME" | jq -r ".Vpcs[0].VpcId")
SECURITY_GROUP_ID=$(aws ec2 describe-security-groups \
                    --group-names default --filters "Name=vpc-id,Values=$VPC_ID" | jq -r ".SecurityGroups[].GroupId")
SUBNET_ID=$(aws ec2 describe-subnets \
                    --filters "Name=tag:Name,Values=$SUBNET_NAME" \
                    | jq -r ".Subnets[0].SubnetId")
ELB_SUBNET_IDS=$(aws ec2 describe-subnets --filters "Name=tag:Name,Values=$ELB_SUBNET_NAMES" \
                     | jq -r ".Subnets[].SubnetId" | tr "\n" " " | sed 's/ $//';)
